import unittest

import numpy as np


from prototype.utils.linalg import skew
from prototype.utils.linalg import skewsq
from prototype.utils.linalg import nullspace


class LinalgTest(unittest.TestCase):
    def test_skew(self):
        v = np.array([[1.0], [2.0], [3.0]])
        X = skew(v)
        X_expected = np.array([[0.0, -3.0, 2.0],
                               [3.0, 0.0, -1.0],
                               [-2.0, 1.0, 0.0]])

        self.assertTrue(np.array_equal(X, X_expected))

    def test_skewsq(self):
        v = np.array([[1.0], [2.0], [3.0]])
        X = skewsq(v)
        print(X)

    def test_nullspace(self):
        A = np.array([[1.0, 2.0, 3.0],
                      [4.0, 5.0, 6.0],
                      [7.0, 8.0, 9.0]])

        # Find nullspace
        x = nullspace(A)

        # Check nullspace
        y = np.dot(A, x)
        res = np.abs(y).max()
        self.assertTrue(abs(res) < 0.0000001)

        H_f_j = np.array([
          [2.9405e-03, -1.2270e-02,  5.9411e-05],
          [2.5988e-03, -4.1072e-05, -1.2229e-02],
          [3.0026e-03, -1.2403e-02,  4.0170e-05],
          [2.6408e-03, -3.1454e-05, -1.2338e-02],
          [3.0653e-03, -1.2531e-02,  2.0896e-05],
          [2.6842e-03, -2.1453e-05, -1.2450e-02],
          [3.1336e-03, -1.2660e-02, -1.9392e-05],
          [2.7274e-03,  3.7372e-06, -1.2576e-02],
          [3.2034e-03, -1.2783e-02, -6.6425e-05],
          [2.7696e-03,  3.8301e-05, -1.2701e-02],
          [3.2729e-03, -1.2896e-02, -1.1642e-04],
          [2.8085e-03,  8.4005e-05, -1.2818e-02],
          [3.3356e-03, -1.2996e-02, -1.4955e-04],
          [2.8469e-03,  1.2196e-04, -1.2922e-02],
          [3.3974e-03, -1.3086e-02, -1.8434e-04],
          [2.8833e-03,  1.6776e-04, -1.3020e-02],
          [3.4554e-03, -1.3166e-02, -2.1124e-04],
          [2.9215e-03,  2.0870e-04, -1.3119e-02],
          [3.5154e-03, -1.3242e-02, -2.5054e-04],
          [2.9595e-03,  2.6079e-04, -1.3225e-02],
          [3.5723e-03, -1.3316e-02, -2.8030e-04],
          [3.0023e-03,  3.0417e-04, -1.3337e-02],
          [3.6270e-03, -1.3379e-02, -3.1289e-04],
          [3.0418e-03,  3.5991e-04, -1.3441e-02],
          [3.6786e-03, -1.3441e-02, -3.3842e-04],
          [3.0865e-03,  4.1376e-04, -1.3547e-02],
          [3.7242e-03, -1.3500e-02, -3.4140e-04],
          [3.1326e-03,  4.5149e-04, -1.3647e-02],
          [3.7646e-03, -1.3558e-02, -3.2588e-04],
          [3.1817e-03,  4.7702e-04, -1.3740e-02],
        ])

        A = nullspace(H_f_j.T)
